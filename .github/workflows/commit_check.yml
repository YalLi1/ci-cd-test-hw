name: Enhanced Python Checks

on: [push, pull_request]

jobs:
  check:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    
    - name: Install tools
      run: pip install black isort flake8 mypy
    
    # BLACK - –ü–û–ù–Ø–¢–ù–´–ô –í–´–í–û–î
    - name: Black Check (Readable)
      run: |
        echo "=== BLACK FORMATTING ISSUES ==="
        echo ""
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–π —Ñ–∞–π–ª –æ—Ç–¥–µ–ª—å–Ω–æ –¥–ª—è –ø–æ–Ω—è—Ç–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞
        for file in $(find . -name "*.py" -not -path "./venv/*" -not -path "./.git/*"); do
          if ! black --check --quiet "$file" 2>/dev/null; then
            echo "üìÑ File: $file"
            echo "üîß Run: black '$file'"
            echo ""
          fi
        done
        
        # –û–±—â–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
        echo "=== SUMMARY ==="
        if black --check . > /dev/null 2>&1; then
          echo "‚úÖ All files are properly formatted"
        else
          echo "‚ùå Some files need formatting"
          echo "Files to fix:"
          black --check . 2>&1 | grep "would reformat" | sed 's/.* //'
        fi
    
    # ISORT - –ü–û–ù–Ø–¢–ù–´–ô –í–´–í–û–î
    - name: Isort Check (Readable)
      run: |
        echo "=== ISORT IMPORT ISSUES ==="
        echo ""
        
        # –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è —á–∏—Ç–∞–µ–º–æ–≥–æ diff
        for file in $(find . -name "*.py" -not -path "./venv/*" -not -path "./.git/*"); do
          if ! isort --check-only --quiet "$file" 2>/dev/null; then
            echo "üìÑ File: $file"
            echo "Current imports:"
            grep -n "^import\|^from" "$file" || echo "  (no imports found)"
            echo "üîß Run: isort '$file'"
            echo ""
          fi
        done
        
        echo "=== SUMMARY ==="
        if isort --check-only . > /dev/null 2>&1; then
          echo "‚úÖ All imports are sorted"
        else
          echo "‚ùå Some files have unsorted imports"
          isort --check-only . 2>&1 | grep "ERROR" | awk '{print "  - " $2}'
        fi
    
    # FLAKE8 - –° –ì–†–£–ü–ü–ò–†–û–í–ö–û–ô
    - name: Flake8 Check
      run: |
        echo "=== FLAKE8 ISSUES ==="
        echo ""
        
        # –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ –ø–æ —Ñ–∞–π–ª–∞–º
        flake8 . | while read line; do
          file=$(echo "$line" | cut -d: -f1)
          issue=$(echo "$line" | cut -d: -f2-)
          echo "üìÑ $file"
          echo "   $issue"
          echo ""
        done || true
        
        echo "=== SUMMARY ==="
        count=$(flake8 --count . | tail -1)
        echo "Total issues: $count"
    
    # MYPY - –ü–†–û–°–¢–û–ô –í–´–í–û–î
    - name: Mypy Check
      run: |
        echo "=== MYPY TYPE ISSUES ==="
        mypy --ignore-missing-imports --no-error-summary .
